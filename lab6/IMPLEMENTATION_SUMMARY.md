# Реализация функциональности отзывов

## Выполненные задачи

### 1. Модель Review (app/models.py)
✅ Добавлена модель Review с полями:
- `id` - идентификатор отзыва (INTEGER PRIMARY KEY)
- `rating` - оценка от 0 до 5 (INTEGER NOT NULL)
- `text` - текст отзыва (TEXT NOT NULL)
- `created_at` - дата и время создания (DATETIME)
- `course_id` - идентификатор курса (INTEGER FK)
- `user_id` - идентификатор пользователя (INTEGER FK)

✅ Добавлены отношения:
- `course` - связь с курсом
- `user` - связь с пользователем
- Обратные связи в моделях Course и User

### 2. Репозиторий ReviewRepository (app/repositories/review_repository.py)
✅ Реализованы методы:
- `add_review()` - создание нового отзыва
- `get_user_review_for_course()` - получение отзыва пользователя для курса
- `get_recent_reviews_by_course()` - получение последних отзывов
- `get_reviews_by_course()` - получение отзывов с пагинацией и сортировкой
- `update_course_rating()` - обновление рейтинга курса

### 3. Маршруты (app/courses.py)
✅ Добавлены маршруты:
- `GET /courses/<id>` - обновлен для отображения отзывов
- `GET /courses/<id>/reviews` - страница всех отзывов с пагинацией
- `POST /courses/<id>/reviews/create` - создание отзыва

### 4. Шаблоны
✅ Обновлен `app/templates/courses/show.html`:
- Отображение последних 5 отзывов
- Форма создания отзыва (если пользователь не оставлял отзыв)
- Отображение существующего отзыва пользователя
- Кнопка "Все отзывы"

✅ Создан `app/templates/courses/reviews.html`:
- Список всех отзывов с пагинацией
- Фильтр сортировки (по новизне, положительные, отрицательные)
- Форма создания отзыва
- Навигация breadcrumb

### 5. Функциональность отзывов
✅ **Создание отзывов**:
- Форма с селектором оценки (0-5) и текстовым полем
- Валидация данных
- Проверка на дублирование (один отзыв на пользователя)
- Автоматический пересчет рейтинга курса

✅ **Просмотр отзывов**:
- Последние 5 отзывов на странице курса
- Отдельная страница со всеми отзывами
- Отображение имени пользователя, даты, оценки и текста

✅ **Пагинация**:
- 10 отзывов на страницу
- Навигация по страницам
- Сохранение параметров сортировки при переходе

✅ **Сортировка**:
- По новизне (по умолчанию)
- Сначала положительные (по убыванию рейтинга)
- Сначала отрицательные (по возрастанию рейтинга)

✅ **Авторизация**:
- Только авторизованные пользователи могут создавать отзывы
- Анонимные пользователи видят отзывы без возможности создания

### 6. Тесты (tests/test_reviews.py)
✅ Созданы базовые тесты:
- Тест создания модели Review
- Тест методов ReviewRepository
- Тест маршрутов создания отзыва

### 7. Дополнительные файлы
✅ `README.md` - инструкции по установке и запуску
✅ `app.py` - основной файл для запуска приложения
✅ Обновлен `requirements.txt` с pytest

## Особенности реализации

1. **Безопасность**: Проверка авторизации перед созданием отзыва
2. **Валидация**: Проверка корректности данных (рейтинг 0-5, не пустой текст)
3. **Уникальность**: Один пользователь может оставить только один отзыв к курсу
4. **UX**: Автоматическое скрытие формы, если пользователь уже оставил отзыв
5. **Производительность**: Эффективные запросы с пагинацией
6. **Рейтинг**: Автоматический пересчет при добавлении отзыва

## Соответствие требованиям

✅ Модель Review с требуемыми полями
✅ Миграция базы данных (готова к выполнению)
✅ Отображение 5 последних отзывов на странице курса
✅ Страница всех отзывов с пагинацией
✅ Сортировка отзывов (новизна, положительные, отрицательные)
✅ Форма создания отзыва с селектором оценки
✅ Проверка на дублирование отзывов
✅ Пересчет рейтинга курса
✅ Тесты функциональности

Приложение готово к развертыванию и тестированию!
